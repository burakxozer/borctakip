<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bor√ß Takip</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root{
  --bg:#f4f6f8;
  --card:#ffffff;
  --text:#111;
  --line:#d1d5db;
  --blue:#2563eb;
  --green:#16a34a;
  --red:#dc2626;
}

body.dark{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#e5e7eb;
  --line:#334155;
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
}

header{
  padding:16px;
  background:var(--blue);
  color:#fff;
  font-size:20px;
  font-weight:600;
  text-align:center;
}

.container{
  padding:16px;
  max-width:760px;
  margin:auto;
}

.row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}

button{
  border:none;
  padding:10px 14px;
  border-radius:10px;
  font-size:14px;
  cursor:pointer;
}

.btn-primary{background:var(--blue);color:#fff;}
.btn-green{background:var(--green);color:#fff;}
.btn-red{background:var(--red);color:#fff;}
.btn-outline{background:var(--card);border:1px solid var(--line);color:var(--text);}

.card{
position: relative;
  background:var(--card);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.05);
}

.bold{font-weight:600}
.small{font-size:13px;color:gray}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:20;
}

.modal-content{
position: relative;
  background:var(--card);
  color:var(--text);
  padding:16px;
  border-radius:14px;
  width:92%;
  max-width:420px;
  max-height:90vh;
  overflow:auto;
}

input,select{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
  border:1px solid var(--line);
  background:var(--card);
  color:var(--text);
}

.close-btn{
  position:absolute;
  top:10px;
  left:10px;
  font-size:22px;
  font-weight:600;
  background:none;
  border:none;
  color:var(--text);
  cursor:pointer;
}

.more-menu{
  position:absolute;
  top:10px;
  right:10px;
}

.more-btn{
  background:none;
  font-size:20px;
  border:none;
  color:var(--text);
}

.more-list{
  display:none;
  position:absolute;
  right:0;
  background:var(--card);
  border:1px solid var(--line);
  border-radius:10px;
  overflow:hidden;
  z-index:5;
}

.more-list button{
  width:100%;
  padding:10px 14px;
  background:none;
  border:none;
  text-align:left;
  color:var(--text);
}

.more-list button:hover{
  background:rgba(0,0,0,.05);
}


</style>
</head>

<body>

<header>Bor√ß Takip</header>

<div class="container">

  <div class="row" style="margin-bottom:12px">
    <button class="btn-primary" onclick="openForm()">‚ûï √ñdeme Ekle</button>
    <button class="btn-green" onclick="openPaid()">‚úîÔ∏è √ñdenenler</button>
    <button class="btn-outline" onclick="openSettings()">‚öôÔ∏è Ayarlar</button>
  </div>

  <!-- AKTƒ∞F Fƒ∞LTRE -->
  <div class="card">
    <div class="bold">‚è≥ Aktif Bor√ß Filtrele</div><br>
    <input type="date" id="af_start">
    <input type="date" id="af_end">
    <button class="btn-outline" onclick="applyActiveFilter()">Filtrele</button>
    <button class="btn-outline" onclick="clearActiveFilter()">T√ºm Aktifler</button>
  </div>

  <div class="card bold" id="total"></div>
  <div id="aktifList"></div>

</div>

<!-- FORM -->
<div class="modal" id="formModal">
  <div class="modal-content">
    <h3>√ñdeme</h3>
    <input type="date" id="f_date">
    <input type="text" id="f_amount" placeholder="Tutar" oninput="formatAmount(this)">
    <input type="text" id="f_desc" placeholder="A√ßƒ±klama">
    <input type="text" id="f_person" placeholder="Kime">
    <select id="f_method">
      <option>Kredi Kartƒ±</option>
      <option>Nakit</option>
      <option>Havale / EFT</option>
    </select>
    <button class="btn-primary" onclick="save()">Kaydet</button>
  </div>
</div>

<!-- √ñDENENLER -->
<div class="modal" id="paidModal">
  <div class="modal-content">
<button class="close-btn" onclick="paidModal.style.display='none'">‚úï</button>
    <h3>√ñdenen Bor√ßlar</h3>

    <input type="date" id="pf_start">
    <input type="date" id="pf_end">
    <button class="btn-outline" onclick="renderPaid()">Filtrele</button>

    <div id="paidList"></div>
  </div>
</div>

<!-- DETAY -->
<div class="modal" id="detailModal">
  <div class="modal-content" id="detailContent"></div>
</div>

<!-- AYARLAR -->
<div class="modal" id="settingsModal">
  <div class="modal-content">
    <h3>Ayarlar</h3>

    <b>Tema</b>
    <select onchange="setTheme(this.value)">
      <option value="">Light</option>
      <option value="dark">Dark</option>
    </select>

    <hr>

    <b>Dƒ±≈üa Aktar</b>
    <select id="ex_type">
      <option value="aktif">Aktif Bor√ßlar</option>
      <option value="odendi">√ñdenen Bor√ßlar</option>
      <option value="hepsi">Her ƒ∞kisi</option>
    </select>
    <input type="date" id="ex_start">
    <input type="date" id="ex_end">
    <button class="btn-outline" onclick="exportCSV()">Excel</button>
    <button class="btn-outline" onclick="exportPDF()">PDF</button>

    <hr>

    <button class="btn-red" onclick="confirmReset()">T√ºm Verileri Sil</button>
  </div>
</div>

<!-- RESET -->
<div class="modal" id="resetModal">
  <div class="modal-content">
    <h3>‚ö†Ô∏è Emin misin?</h3>
    <button class="btn-red" onclick="resetAll()">Onayla</button>
    <button class="btn-outline" onclick="closeReset()">Vazge√ß</button>
  </div>
</div>

<script>
let borclar = JSON.parse(localStorage.getItem("borclar")) || [];
let activeFiltered = null;
let editId = null;

function toggleMenu(btn){
  const menu = btn.nextElementSibling;
  menu.style.display = menu.style.display === "block" ? "none" : "block";
}

function titleCaseTR(text){
  return text
    .toLocaleLowerCase("tr-TR")
    .split(" ")
    .filter(w => w.length)
    .map(w => w.charAt(0).toLocaleUpperCase("tr-TR") + w.slice(1))
    .join(" ");
}


/* THEME */
function setTheme(t){
  document.body.className = t || "";
  localStorage.setItem("theme",t);
}
const savedTheme = localStorage.getItem("theme");
if(savedTheme) setTheme(savedTheme);

/* UTIL */
const trDate=d=>new Date(d).toLocaleDateString("tr-TR");
const gun=d=>new Date(d).toLocaleDateString("tr-TR",{weekday:"long"});
const parseAmount=v=>Number(v.replace(/\./g,""));
function formatAmount(el){
  el.value = el.value.replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,".");
}

/* ACTIVE FILTER */
function applyActiveFilter(){
  const s=af_start.value,e=af_end.value;
  activeFiltered = borclar.filter(x=>
    x.durum==="aktif" &&
    (!s||x.date>=s) &&
    (!e||x.date<=e)
  );
  render();
}
function clearActiveFilter(){
  activeFiltered=null;
  af_start.value=af_end.value="";
  render();
}

/* FORM A√á / KAPAT */
function openForm(){
  f_date.value = "";
  f_amount.value = "";
  f_desc.value = "";
  f_person.value = "";
  f_method.value = "Kredi Kartƒ±";
  formModal.style.display = "flex";
}

/* KAYDET */
function save(){
  if(!f_date.value || !f_amount.value){
    alert("Tarih ve tutar zorunlu");
    return;
  }

  if(editId){
    // G√úNCELLEME
    const x = borclar.find(b=>b.id===editId);
    x.date = f_date.value;
    x.amount = parseAmount(f_amount.value);
    x.desc = titleCaseTR(f_desc.value);
x.person = titleCaseTR(f_person.value);
    x.method = f_method.value;
    editId = null;
  }else{
    // YENƒ∞ KAYIT
    borclar.push({
  id: Date.now(),
  date: f_date.value,
  amount: parseAmount(f_amount.value),
  desc: titleCaseTR(f_desc.value),
  person: titleCaseTR(f_person.value),
  method: f_method.value,
  durum: "aktif"
});

  }

  formModal.style.display = "none";
  activeFiltered = null;
  render();
}



/* RENDER */
function render(){
  const list = activeFiltered || borclar.filter(x=>x.durum==="aktif");
  let toplam = list.reduce((s,x)=>s+x.amount,0);
  total.innerText = `Toplam Aktif Bor√ß: ${toplam.toLocaleString("tr-TR")} ‚Ç∫`;

  aktifList.innerHTML = "";

  list.forEach(x=>{
    aktifList.innerHTML += `
    <div class="card">
      <div class="bold">${trDate(x.date)} (${gun(x.date)})</div>
      <div class="small">${x.desc} ‚Ä¢ ${x.person} ‚Ä¢ ${x.method}</div>
      <div class="bold">${x.amount.toLocaleString("tr-TR")} ‚Ç∫</div>

      <div class="more-menu">
  <button class="more-btn" onclick="toggleMenu(this)">‚ãÆ</button>
 <div class="more-list">
  <button onclick="markPaid(${x.id})">‚úÖ √ñdendi</button>
  <button onclick="editItem(${x.id})">‚úèÔ∏è D√ºzenle</button>
  <button onclick="deleteItem(${x.id})">üóëÔ∏è Sil</button>
</div>
</div>
`;
  });
}

function markPaid(id){
  const x = borclar.find(b=>b.id===id);
  x.durum = "odendi";
  x.odemeTarihi = trDate(new Date());
  activeFiltered = null;
  render();
}

function editItem(id){
  const x = borclar.find(b=>b.id===id);
  editId = id;

  f_date.value = x.date;
  f_amount.value = x.amount.toLocaleString("tr-TR");
  f_desc.value = x.desc;
  f_person.value = x.person;
  f_method.value = x.method;

  formModal.style.display = "flex";
}


function deleteItem(id){
  if(confirm("Bu bor√ß silinsin mi?")){
    borclar = borclar.filter(b=>b.id!==id);
    render();
  }
}

/* √ñDENEN */
function openPaid(){
  paidModal.style.display="flex";
  renderPaid();
}
function renderPaid(){
  const s=pf_start.value,e=pf_end.value;
  const list = borclar.filter(x=>
    x.durum==="odendi" &&
    (!s||x.odemeTarihi>=trDate(s)) &&
    (!e||x.odemeTarihi<=trDate(e))
  );
  paidList.innerHTML="";
  list.forEach(x=>{
    paidList.innerHTML+=`
    <div class="card" onclick="showDetail(${x.id})">
      <div class="bold">${x.desc}</div>
      <div class="small">${x.amount.toLocaleString("tr-TR")} ‚Ç∫</div>
    </div>`;
  });
}
function showDetail(id){
  const x = borclar.find(b=>b.id===id);
  detailContent.innerHTML = `
    <button class="close-btn" onclick="detailModal.style.display='none'">‚úï</button>

    <h3>${x.desc}</h3>
    <p><b>Vade:</b> ${trDate(x.date)} (${gun(x.date)})</p>
    <p><b>Kime:</b> ${x.person}</p>
    <p><b>√ñdeme:</b> ${x.method}</p>
    <p><b>Tutar:</b> ${x.amount.toLocaleString("tr-TR")} ‚Ç∫</p>
    <p><b>√ñdendi:</b> ${x.odemeTarihi}</p>
  `;
  detailModal.style.display = "flex";
}


/* EXPORT */
function getExportData(){
  const t=ex_type.value,s=ex_start.value,e=ex_end.value;
  return borclar.filter(x=>{
    if(t==="aktif"&&x.durum!=="aktif")return false;
    if(t==="odendi"&&x.durum!=="odendi")return false;
    if(s&&x.date<s)return false;
    if(e&&x.date>e)return false;
    return true;
  });
}
function exportCSV(){
  let csv="\uFEFFDurum;Vade;G√ºn;A√ßƒ±klama;Kime;√ñdeme ≈ûekli;Tutar;√ñdeme Tarihi\n";
  getExportData().forEach(x=>{
    csv+=`${x.durum};${trDate(x.date)};${gun(x.date)};${x.desc};${x.person};${x.method};${x.amount};${x.odemeTarihi||""}\n`;
  });
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv;charset=utf-8;"}));
  a.download="borclar.csv";a.click();
}
function exportPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF({unit:"pt",format:"a4"});
  let y=40;
  getExportData().forEach(x=>{
    pdf.text(`Durum: ${x.durum}`,40,y); y+=14;
    pdf.text(`Vade: ${trDate(x.date)} (${gun(x.date)})`,40,y); y+=14;
    pdf.text(`A√ßƒ±klama: ${x.desc}`,40,y); y+=14;
    pdf.text(`Kime: ${x.person}`,40,y); y+=14;
    pdf.text(`√ñdeme: ${x.method}`,40,y); y+=14;
    pdf.text(`Tutar: ${x.amount.toLocaleString("tr-TR")} ‚Ç∫`,40,y); y+=14;
    if(x.odemeTarihi){pdf.text(`√ñdendi: ${x.odemeTarihi}`,40,y); y+=14;}
    y+=10;
    if(y>760){pdf.addPage();y=40;}
  });
  pdf.save("borclar.pdf");
}

/* SETTINGS */
function openSettings(){settingsModal.style.display="flex"}
function confirmReset(){resetModal.style.display="flex"}
function closeReset(){resetModal.style.display="none"}
function resetAll(){
  localStorage.clear();
  borclar=[];
  closeReset();
  settingsModal.style.display="none";
  render();
}

window.onclick=e=>{
  if(e.target.classList.contains("modal")) e.target.style.display="none";
};

render();
</script>

</body>
</html>
